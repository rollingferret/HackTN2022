<!DOCTYPE html>
<html>

<head>
  <title>Add Map</title>

  <style type="text/css">
    /* Set the size of the div element that contains the map */
    #map {
      height: 400px;
      /* The height is 400 pixels */
      width: 100%;
      /* The width is the width of the web page */
    }
  </style>
  <script>
    // Initialize and add the map
    async function initMap() {
      const res = await fetch('./formatted_daycares.json')
      const dayCares = await res.json()
      const dayCaresArray = Object.values(dayCares)
  

      let lat
      let long

      if(navigator.geolocation) {
          console.log("navigator.geolocation is available");
          navigator.geolocation.getCurrentPosition(function(position) {
          console.log("current position acquired");
          lat = Number(position.coords.latitude)
          long = Number(position.coords.longitude)
          console.log(lat, long)
      });
}

      // The location of Tenn
      const tenn = { lat: lat?lat:35.823659, lng: long?long:-84.046718 };

      // The map, centered at Tenn
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 13,
        center: tenn,
      });

      let circle = new google.maps.Circle({
          radius: 1200,
          center: tenn,
          strokeColor: 'transparent',
          strokeOpacity: 0,
          strokeWeight: 5,
          fillColor:'#FF0000',
          fillOpacity: 0.2,
          map,
      })

      let dayCareMarkers = dayCaresArray.map((dayCare) => {
        if (dayCare.coordinates.accuracy === 'exact') {
        const position = { lat: dayCare.coordinates.latitude, lng: dayCare.coordinates.longitude }

        return new google.maps.Marker({
          position,
          map
        })
      }
      })
      // The marker, positioned at Uluru
      const marker = new google.maps.Marker({
        position: tenn,
        map: map,
      });
    }
  </script>
</head>

<body>
  <div id="react">
  </div>
  <h3>My Google Maps Demo</h3>
  <!--The div element for the map -->
  <div id="map"></div>

  <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
  <script src="https://maps.googleapis.com/maps/api/js?key=%REACT_APP_GOOGLEMAPS%&callback=initMap&libraries=&v=weekly"
    async></script>
</body>

</html>
