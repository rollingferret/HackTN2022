<!DOCTYPE html>
<html>

<head>
  <title>Add Map</title>

  <style type="text/css">
    /* Set the size of the div element that contains the map */
    #map {
      height: 80vh;
      /* The height is 400 pixels */
      width: 70vw;
      /* The width is the width of the web page */
    }
  </style>
  <script>
    // Initialize and add the map
    async function initMap() {
      const res = await fetch('./formatted_daycares.json')
      const dayCares = await res.json()
      const dayCaresArray = Object.values(dayCares)


      let lat
      let long

      if (navigator.geolocation) {
        console.log("navigator.geolocation is available");
        navigator.geolocation.getCurrentPosition(function (position) {
          console.log("current position acquired");
          lat = Number(position.coords.latitude)
          long = Number(position.coords.longitude)
          console.log(lat, long)
        });
      }

      // The location of Tenn
      const tenn = { lat: lat ? lat : 35.823659, lng: long ? long : -84.046718 };

      // The map, centered at Tenn
      const map = new google.maps.Map(document.getElementById("map"), {
        zoom: 13,
        center: tenn,
        title: 'You are here!'
      });

      let circle = new google.maps.Circle({
        radius: 1200,
        center: tenn,
        strokeColor: 'transparent',
        strokeOpacity: 0,
        strokeWeight: 5,
        fillColor: '#FF0000',
        fillOpacity: 0.2,
        map,
      })
      console.log(dayCaresArray.length)
      let dayCareMarkers = dayCaresArray.map((dayCare, i) => {
        console.log(i)
        if (dayCare.coordinates.accuracy === 'exact') {

          const position = { lat: dayCare.coordinates.latitude, lng: dayCare.coordinates.longitude }
          let name = dayCare.name
          let i = 0;

          let tempLocation = this['location' + i]
          let tempWindow = this['infoWindow' + i]


          tempLocation = new google.maps.Marker({
            position,
            map,
            title: name,
          })

          tempWindow = new google.maps.InfoWindow({
            content: name,
          })

          tempLocation.addListener("click", () => {
            console.log('hiiii')
            tempWindow.open({
              anchor: tempLocation,
              map,
              shouldFocus: false,
            });

            setTimeout(function () { tempWindow.close(); }, 5000);

          });


          i++
        }
      })
      // The marker, positioned at Tenn
      const marker = new google.maps.Marker({
        position: tenn,
        map: map,
        title: 'You are here!',
      });
    }
  </script>
</head>

<body>
  <div id="react">
  </div>
  <h3>My Google Maps Demo</h3>
  <!--The div element for the map -->
  <div id="map"></div>

  <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
  <script src="https://maps.googleapis.com/maps/api/js?key=%REACT_APP_GOOGLEMAPS%&callback=initMap&libraries=&v=weekly"
    async></script>
</body>

</html>
